# ./get_region_and_token.sh
Do you want to connect (y/n)?y
Do you want to enable port forwarding (y/n) ?y
PIA Username: pxxxxxx
PIA Password: *****************************************************************

Getting the server list... OK!
Testing regions that respond faster than 0.05 seconds:
Got latency 0.015014s for region: Bahamas (geo)
Got latency 0.048203s for region: CA Ontario
Got latency 0.048744s for region: CA Montreal
Got latency 0.042822s for region: CA Toronto
Got latency 0.020732s for region: Mexico (geo)
Got latency 0.044795s for region: US East
Got latency 0.036053s for region: US Houston
Got latency 0.021671s for region: US Atlanta
Got latency 0.046103s for region: US New York
Got latency 0.017818s for region: US Florida
Got latency 0.041158s for region: US Texas
Got latency 0.024131s for region: Brazil (geo)
The closest region is Bahamas (geolocated region).

The script found the best servers from the region closest to you.
When connecting to an IP (no matter which protocol), please verify
the SSL/TLS certificate actually contains the hostname so that you
are sure you are connecting to a secure server, validated by the
PIA authority. Please find bellow the list of best IPs and matching
hostnames for each protocol:
Meta Services: 45.132.143.230 // bahamas401
WireGuard: 45.132.143.232 // bahamas401
OpenVPN TCP: 45.132.143.234 // bahamas401
OpenVPN UDP: 45.132.143.234 // bahamas401

The ./get_region_and_token.sh script got started with PIA_USER and PIA_PASS,
so we will also use a meta service to get a new VPN token.
Trying to get a new token by authenticating with the meta service...
{
    "status": "OK",
    "token": "weDLB5ohx+REDACTED"
}
This token will expire in 24 hours.

The ./get_region_and_token.sh script got started with PIA_AUTOCONNECT=wireguard,
so we will automatically connect to WireGuard, by running this command:
$ WG_TOKEN="weDLB5ohx+REDACTED" \
  WG_SERVER_IP=45.132.143.232 WG_HOSTNAME=bahamas401 \
  PIA_PF=true ./connect_to_wireguard_with_token.sh

You should consider disabling IPv6 by adding the following lines to /etc/rc.conf:
ip6addrctl_enable="NO"
ip6addrctl_policy="ipv4_prefer"
ipv6_activate_all_interfaces="NO"

Trying to connect to the PIA WireGuard API on 45.132.143.232...
{
    "status": "OK",
    "server_key": "REDACTED",
    "server_port": 1337,
    "server_ip": "45.132.143.232",
    "server_vip": "10.2.128.1",
    "peer_ip": "10.2.136.203/32",
    "peer_pubkey": "REDACTED",
    "dns_servers": [
        "10.0.0.242",
        "10.0.0.244"
    ]
}
Trying to write /etc/wireguard/pia.conf... OK!

Trying to create the wireguard interface...
Warning: `/etc/wireguard/pia.conf' is world accessible
[#] wireguard-go pia
INFO: (pia) 2020/09/19 04:21:56 Starting wireguard-go version 0.0.20200320
[#] wg setconf pia /tmp/tmp.DzoaZ3Iz/sh-np.vwNmnP
[#] ifconfig pia inet 10.2.136.203/32 10.2.136.203 alias
[#] ifconfig pia mtu 1420
[#] ifconfig pia up
[#] resolvconf -a pia -x
[#] route -q -n add -inet 0.0.0.0/1 -interface pia
[#] route -q -n add -inet 128.0.0.0/1 -interface pia
[#] route -q -n add -inet 45.132.143.232 -gateway 192.168.1.1
[+] Backgrounding route monitor
The WireGuard interface got created.
At this point, internet should work via VPN.

--> to disconnect the VPN, run:
$ wg-quick down pia

This script got started with PIA_PF=true.
Starting procedure to enable port forwarding by running the following command:
$ PIA_TOKEN=weDLB5ohx+REDACTED \
  PF_GATEWAY="10.2.128.1" \
  PF_HOSTNAME="bahamas401" \
  ./port_forwarding.sh

Getting new signature...
{
    "status": "OK",
    "payload": "REDACTED",
    "signature": "REDACTED"
}
The signature is OK.

--> The port is 57058 and it will expire on 2020-11-20T20:21:13.073068998Z. <--

Trying to bind the port...
{
    "status": "OK",
    "message": "port scheduled for add"
}
Warning: Ignoring 11 extraneous characters in date string (.073068998Z)
Port 57058 refreshed on Sat Sep 19 04:21:57 EDT 2020. This port will expire on Fri Nov 20 20:21:13 EST 2020
